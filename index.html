<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="Murder Death Click by Centaur Reader">
    <meta property="og:site_name" content="Murder Death Click by Centaur Reader">
    <meta property="og:url" content="https://centaurreader.com/rpg">
    <meta property="og:image" content="https://centaurreader.com/rpg/hero.gif">
    <title>Murder Death Click by Centaur Reader</title>
    <link rel="stylesheet" href="reset.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@500;900&display=swap" rel="stylesheet">

    <!-- generics -->
    <link rel="icon" href="favicons/favicon-32.png" sizes="32x32">
    <link rel="icon" href="favicons/favicon-57.png" sizes="57x57">
    <link rel="icon" href="favicons/favicon-76.png" sizes="76x76">
    <link rel="icon" href="favicons/favicon-96.png" sizes="96x96">
    <link rel="icon" href="favicons/favicon-128.png" sizes="128x128">
    <link rel="icon" href="favicons/favicon-192.png" sizes="192x192">
    <link rel="icon" href="favicons/favicon-228.png" sizes="228x228">
    
    <!-- Android -->
    <link rel="shortcut icon" sizes="196x196" href=“favicons/favicon-196.png">
    
    <!-- iOS -->
    <link rel="apple-touch-icon" href="favicons/favicon-120.png" sizes="120x120">
    <link rel="apple-touch-icon" href="path/to/favicon-152.png" sizes="152x152">
    <link rel="apple-touch-icon" href="path/to/favicon-180.png" sizes="180x180">
    
    <!-- Windows 8 IE 10-->
    <meta name="msapplication-TileColor" content="#2f2c2c">
    <meta name="msapplication-TileImage" content="favicons/favicon-144.png">
    
    <!— Windows 8.1 + IE11 and above —>
    <meta name="msapplication-config" content="favicons/browserconfig.xml" />

    <style>
      * { box-sizing: border-box; }
      body {
        background-color: #2f2c2c;
        color: #f6e8e8;
        font-family: 'Noto Sans JP', sans-serif;
      }

      #dungeon { position: relative; }
      #loot { min-height: 1rem; }

      .title {
        display: flex;
        align-items: center;
        height: 100%;
        padding-left: .5rem;
        max-width: 448px;
        font-size: .75rem;
        font-weight: 900;
        background-color: #f6e8e8;
        color: #2f2c2c;
      }
      .main_container {
        border: 10px solid #f6e8e8;
        display: flex;
        flex-direction: column;
        height: 100%;
        margin: 0 auto;
        max-width: 448px;
        padding: 12px;
      }
      .toolbar {
        display: flex;
        justify-content: space-between;
        max-width: 448px;
        margin: 0 auto;
        background-color: #f6e8e8;
        padding: 10px 10px 0;
      }
      .toolbar--item {
        background-color: #2f2c2c;
        display: inline-block;
      }
      .info_area { flex: 1; }
      .info_area-player { margin-bottom: 88px; }
      .info_area-enemy { margin-top: 16px; }
      .graphics_area { position: relative; height: 168px; }
      .sprite { position: absolute; }
      .sprite-hero {
        top: -72px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 3;
      }
      .sprite-attack {
        bottom: 4px;
        left: 50%;
        transform: translateX(-50%);
        visibility: hidden;
        z-index: 5;
      }
      .sprite-enemy {
        bottom: 4px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 4;
      }
      .sprite-background {
        left: 50%;
        transform: translateX(-50%);
        z-index: 2;
      }

      .visually_hidden { display: none; }

      .label-large {
        font-weight: 900;
        font-size: 1.5rem;
        margin-bottom: .5rem;
      }
      .label-center { text-align: center; }
      .label-medium {
        font-weight: 500;
        font-size: 1.25rem;
        margin-bottom: .5rem;
      }
      .label-small {
        font-weight: 500;
        font-size: 1rem;
        margin-bottom: .5rem;
      }
      .bar {
        border: 4px solid #f6e8e8;
        background-color: transparent;
        height: 1.75rem;
        margin-bottom: .25rem;
        position: relative;
      }
      .bar_filler {
        background-color: #f6e8e8;
        bottom: 0;
        position: absolute;
        top: 0;
        transition: width .125s;
        width: 0;
      }
      .bar_filler-danger {
        background-color: #C93900;
      }
      .action_button {
        background-color: #f6e8e8;
        padding: .5rem;
        font-size: 2rem;
        font-weight: 900;
        color: #2f2c2c;
        border: 0;
        box-shadow: none;
        max-width: 408px;
        width: 80%;
        margin: 1rem auto;
        display: block;
      }
      .action_button:disabled {
        opacity: .25;
      }
      .action_button-hollow {
        background-color: transparent;
        border: 4px solid #f6e8e8;
        color: #f6e8e8;
      }
      .modal {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background-color: #2f2c2c;
        z-index: 1000;
        transform: translateY(100%);
        transition: transform .25s;
      }
      .modal-visible {
        transform: translateY(0);
      }
      .modal-sub {
        transform: translate(-100%, 0);
      }
      .modal_inner {
        display: flex;
        flex-direction: column;
        height: 100%;
        margin: 0 auto;
        max-width: 448px;
        padding: 1rem;
      }
      .modal_inner-no_fill {
        display: inherit;
      }
      #gp {
        text-align: right;
        margin-top: 1rem;
      }
      .container {
        display: flex;
        flex-direction: column;
        flex: 1;
        border: 10px solid #f6e8e8;
        padding: 12px;
        overflow-y: auto;
        margin-top: 1rem;
        background-color: #2f2c2c;
      }
      .container_fill {
        flex: 1;
      }
      .inventory_category {
        background-color: #f6e8e8;
        color: #2f2c2c;
        font-size: 1rem;
        font-weight: 500;
        padding: .25rem;
      }
      .inventory_item {
        display: block;
        margin-bottom: 1.5rem;
        color: #f6e8e8;
        text-decoration: none;
      }
      .inventory_item:hover {
        text-shadow: 2px 2px 2px #C93900;
      }
      .inventory_item-border {
        border-bottom: 2px solid #f6e8e8;
      }

      .app {
        margin: 0 auto;
        max-width: 458px;
        overflow-x: hidden;
      }
      @media screen and (min-width: 550px) {
        .app {
          max-width: 550px;
        }
      }

      .wound {
        position: absolute;
        z-index: 100;
        color: #C93900;
        left: 55%;
        top: -60px;
        transform: translateY(0);
        opacity: 1;
        text-shadow: 2px 2px 2px #2f2c2c;
      }
      .wound-lit {
        transform: translateY(-100%);
        opacity: 0;
        transition: transform .75s, opacity .75s;
        transition-delay: .125s;
      }

      .game_menu_background {
        background-image: url(brick-pattern.gif);
        padding: 4rem 2rem;
        height: 500px;
        margin: 0 auto;
        margin-top: 10vh;
      }
      .game_menu_logo {
        align-self: center;
        margin: .5rem 0;
      }
    </style>
  </head>
  <body>
    <div class="app">
      <ul class="toolbar">
        <li>
          <h1 class="title">
            <img src="helmet.png" height="16" alt="" />
            &nbsp;
            Murder Death Click
          </h1>
        </li>
        <li class="toolbar--item">
          <a href="#" id="inventory_button">
            <img src="inventory.gif" alt="Inventory" />
          </a>
        </li>
      </ul>
      <div id="dungeon" class="main_container">
        <section class="info_area info_area-player">
          <h2 class="visually_hidden">Player</h2>
          <p id="level" class="label-large">Level 1</p>
          <div class="bar">
            <div class="bar_filler" id="xp_status"></div>
          </div>
          <p class="label-medium" id="xp">0 / XXX xp</p>
          <div class="bar">
            <div class="bar_filler" id="hp_status"></div>
          </div>
          <p class="label-medium" id="hp">0 / XXX hp</p>
        </section>
  
        <div class="graphics_area">
          <img class="sprite sprite-hero" src="hero.gif" alt="" />
          <p class="wound" id="wound_indicator"></p>
          <img id="attack" class="sprite sprite-attack" src="attack.gif" alt="" />
          <img id="miss" class="sprite sprite-attack" src="miss.gif" alt="" />
          <img id="enemy" class="sprite sprite-enemy" src="enemy.gif" alt="" />
          <img class="sprite sprite-background" src="floor.gif" alt="" />
        </div>
  
        <section class="info_area info_area-enemy">
          <h2 class="visually_hidden">Enemy</h2>
          <p class="label-large"><span id="enemy_level">Level 1</span> <span id="enemy_name">Fat Orc</span></p>
          <div class="bar">
            <div class="bar_filler" id="enemy_hp_status"></div>
          </div>
          <p class="label-medium" id="enemy_hp">0 / XXX hp</p>
          <p class="label-small" id="loot"></p>
        </section>
  
      </div>
      <button id="attack_action" class="action_button" type="button">Attack</button>
    </div>

    <section id="inventory" class="modal">
      <div class="modal_inner">
        <h1 class="visually_hidden">Equipment</h1>
        <p id="gp" class="label-small">1,000,000 gp</p>
        <div class="container">
          <div id="equipped_items"></div>

          <p class="label-small inventory_category">Unequipped</p>
          <ul id="unequipped_items"></ul>
        </div>
        <button id="inventory_close_button" class="action_button" type="button">Close</button>
      </div>
    </section>

    <section id="inventory_detail" class="modal">
      <div class="modal_inner">
        <h1 class="visually_hidden">Item Detail</h1>
        <div class="container">
          <div id="inventory_detail_item" class="container_fill"></div>
          <div id="inventory_detail_actions"></div>
        </div>
        <button id="inventory_detail_close_button" class="action_button" type="button">Back</button>
      </div>
    </section>

    <section id="game_menu" class="modal modal-visible">
      <div class="modal_inner modal_inner-no_fill game_menu_background">
        <div class="container container-no_fill">
          <img class="game_menu_logo" src="helmet.png" height="32" width="32" alt="" />
          <h1 id="game_menu_title" class="label-large label-center">Murder Death Click</h1>
          <p id="game_menu_description" class="label-small label-center">Murder Orcs. Get Loot. Level Up.</p>
        </div>
        <button id="game_menu_button" class="action_button" type="button">New Game</button>
      </div>
    </section>

    <script>
      /*
        //////////
        BEGIN GAME
        \\\\\\\\\\
      */
      // state
      function State() {
        let state = {
          xp: 0,
          gp: 0,
          hp: 100,
          wounds: 0,
          damage: 6,
          level: 1,
          inventory: [],
          enemy: null,
          inventoryItem: null,
          killCount: 0,
        };
        this.getState = () => state;
        this.setState = incoming => {
          state = {
            ...state,
            ...incoming,
          };
        };
      }
      const gameState = new State();
      const SAVE_KEY = 'rpg-state';
      function save() {
        localStorage.setItem(SAVE_KEY, JSON.stringify(gameState.getState()));
      }
      function validateGameData(data) {
        const tempState = new State();
        return {
          ...tempState.getState(),
          ...(data || {}),
          inventory: ((data || {}).inventory || []).filter((item) => typeof item === 'object'),
        };
      }
      function load() {
        try {
          gameState.setState(validateGameData(JSON.parse(localStorage.getItem(SAVE_KEY))));
          if (!gameState.getState().enemy) {
            genEnemy();
          }
          updateUi(gameState.getState());
        } catch (err) {
          console.log(err);
        }
      }

      // engine
      const equipmentSlots = [
        { key: 'HEAD', value: 'Head', },
        { key: 'BODY', value: 'Body', },
        { key: 'LEFT_HAND', value: 'Left Hand', },
        { key: 'RIGHT_HAND', value: 'Right Hand', },
        { key: 'LEGS', value: 'Legs', },
        { key: 'FEET', value: 'Feet', },
      ];
      const lootTable = [
          [
              { name: 'Amazing', modifier: 9, statType: 'Armor' },
              { name: 'Bad', modifier: 3, statType: 'Armor' },
              { name: 'Broken', modifier: 1, statType: 'Armor' },
              { name: 'Cheap', modifier: 2, statType: 'Armor' },
              { name: 'Cool', modifier: 8,  statType: 'Armor'},
              { name: 'Crappy', modifier: 3, statType: 'Armor', },
              { name: 'Dank', modifier: 10, statType: 'Armor' },
              { name: 'Fancy', modifier: 6, statType: 'Armor' },
              { name: 'Heavy', modifier: 7, statType: 'Armor' },
              { name: 'Magic', modifier: 9, statType: 'Armor' },
              { name: 'Shiny', modifier: 4, statType: 'Armor' },
              { name: 'Ugly', modifier: 3, statType: 'Armor' },
              { name: 'Worthless', modifier: 1, statType: 'Armor' },
          ],
          [
            { name: 'Boots', type: 'FEET', modifier: 5, statType: 'Armor' },
            { name: 'Clogs', type: 'FEET', modifier: 3, statType: 'Armor' },
            { name: 'Sandals', type: 'FEET', modifier: 2, statType: 'Armor' },
            { name: 'Shoes', type: 'FEET', modifier: 4, statType: 'Armor' },

            { name: 'Pants', type: 'LEGS', modifier: 3, statType: 'Armor' },
            { name: 'Loin Cloth', type: 'LEGS', modifier: 1, statType: 'Armor' },
            { name: 'Skirt', type: 'LEGS', modifier: 2, statType: 'Armor' },
            { name: 'Leggings', type: 'LEGS', modifier: 2, statType: 'Armor' },

            { name: 'Cap', type: 'HEAD', modifier: 2, statType: 'Armor' },
            { name: 'Hat', type: 'HEAD', modifier: 3, statType: 'Armor' },
            { name: 'Helmet', type: 'HEAD', modifier: 5, statType: 'Armor' },
            { name: 'Ribbon', type: 'HEAD', modifier: 1, statType: 'Armor' },

            { name: 'Chainmail', type: 'BODY', modifier: 6, statType: 'Armor' },
            { name: 'Cuirass', type: 'BODY', modifier: 5, statType: 'Armor' },
            { name: 'Doublet', type: 'BODY', modifier: 3, statType: 'Armor' },
            { name: 'Shirt', type: 'BODY', modifier: 2, statType: 'Armor' },

            { name: 'Axe', type: 'HAND', modifier: 10, statType: 'Damage' },
            { name: 'Bow', type: 'HAND', modifier: 3, statType: 'Damage' },
            { name: 'Buckler', type: 'HAND', modifier: 2, statType: 'Armor' },
            { name: 'Flail', type: 'HAND', modifier: 6, statType: 'Damage' },
            { name: 'Hammer', type: 'HAND', modifier: 5, statType: 'Damage' },
            { name: 'Heater', type: 'HAND', modifier: 5, statType: 'Armor', },
            { name: 'Lance', type: 'HAND', modifier: 4, statType: 'Damage' },
            { name: 'Mace', type: 'HAND', modifier: 5, statType: 'Damage' },
            { name: 'Scepter', type: 'HAND', modifier: 3, statType: 'Damage' },
            { name: 'Staff', type: 'HAND', modifier: 2, statType: 'Damage' },
            { name: 'Sword', type: 'HAND', modifier: 7, statType: 'Damage' },
            { name: 'Tower Shield', type: 'HAND', modifier: 10, statType: 'Armor' },
          ],
      ];
      const enemyTable = [
        [
          { name: 'Beautiful', modifier: 2 },
          { name: 'Berserk', modifier: 4 },
          { name: 'Bored', modifier: 1 },
          { name: 'Brilliant', modifier: 2 },
          { name: 'Cursed', modifier: 4 },
          { name: 'Dark', modifier: 3 },
          { name: 'Drunk', modifier: 2 },
          { name: 'Dull', modifier: 1 },
          { name: 'Dumpy', modifier: 1 },
          { name: 'Fat', modifier: 2 },
          { name: 'Light', modifier: 3 },
          { name: 'Mystic', modifier: 4 },
          { name: 'Raging', modifier: 3 },
          { name: 'Skinny', modifier: 1 },
          { name: 'Stinky', modifier: 2 },
          { name: 'Stoned', modifier: 1 },
          { name: 'Ugly', modifier: 2 },
          { name: 'Wretched', modifier: 3 },
        ],
        [
          { name: 'Orc', modifier: 2, },
        ],
      ];
      const getEnemyLevelForPlayerLevel = (level) => {
        const diff = Math.floor(Math.random() * 4);
        return Math.abs(diff >= 2 ? level + Math.ceil(diff / 2) : level - diff);
      };
      const getXpForLevel = (level) => {
        const translation = 50;
        const percentageIncrease = .1;
        return Math.ceil(translation * (1 + percentageIncrease)**level);
      };
      const calcXp = (xpToAdd) => {
        const { xp: currentXp, enemy } = gameState.getState();
        const enemyXp = enemy.level * 10
        const newXp = currentXp + enemyXp;
        gameState.setState({
          xp: newXp,
        });
      };
      const calcLevel = () => {
        const { xp, level, hp, wounds } = gameState.getState();
        const shouldLevelUp = xp >= getXpForLevel(level);
        const hpIfLevelUp = hp + ((level + 1) * 10);
        const woundsIfLevelUp = wounds - (hpIfLevelUp - hp) < 0 ? 0 : wounds - (hpIfLevelUp - hp);
        gameState.setState({
          level: shouldLevelUp ? level + 1 : level,
          xp: shouldLevelUp ? 0 : xp,
          hp: shouldLevelUp ? hpIfLevelUp : hp,
          wounds: shouldLevelUp ? woundsIfLevelUp : wounds,
        });
      };
      const shouldLoot = () => {
        const limit = 10000;
        const rng = Math.ceil(Math.random() * limit);
        const skewed = rng / .6;
        return skewed > limit;
      };
      const lootProc = () => {
        if (!shouldLoot()) {
          return;
        }
        const cat1 = Math.floor(Math.random() * lootTable[0].length);
        const cat2 = Math.floor(Math.random() * lootTable[1].length);
        const type = lootTable[1][cat2].type;
        const state = gameState.getState();
        gameState.setState({
          inventory: [
            ...state.inventory,
            {
              name: `${lootTable[0][cat1].name} ${lootTable[1][cat2].name}`,
              quality: lootTable[0][cat1],
              type: lootTable[1][cat2],
              power: (lootTable[0][cat1].modifier * lootTable[1][cat2].modifier) + 10,
              statType: lootTable[1][cat2].statType,
              equipped: null,
            },
          ],
        });
      };
      const calcGp = () => {
        const orcGoldMax = 20;
        const orcGoldMin = 1;
        const goldDropped = Math.ceil(Math.random() * orcGoldMax) || orcGoldMin;

        const state = gameState.getState();
        gameState.setState({
          gp: state.gp + goldDropped,
        });
      };
      const genEnemy = () => {
        const state = gameState.getState();
        const level = getEnemyLevelForPlayerLevel(state.level);
        const type = enemyTable[0][Math.floor(Math.random() * enemyTable[0].length)];
        const enemy = enemyTable[1][Math.floor(Math.random() * enemyTable[1].length)];
        const enemyHp = type.modifier * (enemy.modifier + level);
        gameState.setState({
          enemy: {
            name: `${type.name} ${enemy.name}`,
            level: level === 0 ? 1 : level,
            hp: enemyHp,
            maxHp: enemyHp,
            damage: type.modifier + (enemy.damage || 10),
          },
        });
      };
      const rollDamage = () => {
        const { damage, inventory, } = gameState.getState();
        const arms = inventory.filter((item) => (item.equipped || '').includes('HAND') && item.statType === 'Damage');
        const calculatedDamage = damage + arms.reduce((total, item) => item.power + total, 0);
        return Math.floor(Math.random() * 100) > 25 ? calculatedDamage : 0;
      };
      const rollEnemyDamage = (enemy) => {
        const calculatedDamage = enemy.damage + enemy.level;
        return Math.floor(Math.random() * 100) > 50 ? calculatedDamage : 0;
      };
      const calcWounds = (damage) => {
        const { hp, inventory } = gameState.getState();
        const equippedHpItems = inventory.filter((item) => item.statType === 'Armor' && !!item.equipped);
        const armorRating = equippedHpItems.reduce((total, item) => item.power + total, 0);
        const damageMod = armorRating / 10;
        const calcDamage = damage - damageMod;
        return calcDamage > 0 ? Math.ceil(calcDamage) : 0;
      };
      const reduceEnemyHp = (damage) => {
        const { enemy } = gameState.getState();
        const newHp = enemy.hp - damage;
        gameState.setState({
          enemy: {
            ...enemy,
            hp: newHp <= 0 ? 0 : newHp,
          },
        });
      };
      function onAttack() {
        if (attackButtonEl.disabled) {
          return;
        }
        attack.setAttribute('style', 'visibility: visible');
      }
      function equipItem(slotName, toEquip) {
        const { inventory } = gameState.getState();
        gameState.setState({
          inventory: inventory.map((item) => {
            if (item === toEquip) {
              return {
                ...toEquip,
                equipped: slotName,
              };
            }
            if (item.equipped === slotName) {
              return {
                ...item,
                equipped: null,
              };
            }
            return item;
          }),
          inventoryItem: {
            ...toEquip,
            equipped: slotName,
          },
        });
        updateUi(gameState.getState());
        save();
      }
      function incrementKillCount() {
        gameState.setState({
          killCount: gameState.getState().killCount + 1,
        });
      }
      function tick() {
        if (attackButtonEl.disabled) {
          return;
        }
        attack.setAttribute('style', 'visibility: hidden');

        const damageDone = rollDamage();
        const wounds = calcWounds(rollEnemyDamage(gameState.getState().enemy));
        if (wounds > 0) {
          showWound(`-${wounds}`);
          gameState.setState({ wounds: gameState.getState().wounds + wounds });
        }
        if (damageDone === 0) {
          missEl.setAttribute('style', 'visibility: visible');
          setTimeout(() => { missEl.setAttribute('style', 'visibility: hidden'); }, 500);
        }
        reduceEnemyHp(damageDone);
        if (gameState.getState().enemy.hp <= 0) {
          enemyHpStatusEl.setAttribute('style', 'width: 0');
          setTimeout(() => {
            incrementKillCount();
            calcXp();
            calcLevel();
            lootProc();
            calcGp();
            genEnemy();
            updateUi(gameState.getState());
            save();
          }, 250);
        } else {
          updateUi(gameState.getState());
          save();
        }

        if (gameState.getState().wounds >= gameState.getState().hp) {
          attackButtonEl.disabled = true;
          setTimeout(() => {
            gameMenuTitleEl.innerText = 'You died';
            const killCount = new Intl.NumberFormat(navigator.language).format(gameState.getState().killCount);
            gameMenuDescriptionEl.innerText = `after murdering ${killCount} orcs.`;
            localStorage.removeItem('rpg-state');
            gameMenuModalEl.classList.add('modal-visible');
          }, 1000);
        }
      }

      /*
        \\\\\\\\
        BEGIN UI
        ////////
      */
      // main ui
      const inventoryButtonEl = document.getElementById('inventory_button');
      const xpEl = document.getElementById('xp');
      const xpStatusEl = document.getElementById('xp_status');
      const hpEl = document.getElementById('hp');
      const hpStatusEl = document.getElementById('hp_status');
      const levelEl = document.getElementById('level');
      const woundIndicatorEl = document.getElementById('wound_indicator');
      const enemyNameEl = document.getElementById('enemy_name');
      const enemyLevelEl = document.getElementById('enemy_level');
      const enemyHpEl = document.getElementById('enemy_hp');
      const enemyHpStatusEl = document.getElementById('enemy_hp_status');
      const hitEl = document.getElementById('attack');
      const missEl = document.getElementById('miss');
      const attackButtonEl = document.getElementById('attack_action');
      const lootDropEl = document.getElementById('loot');
      // inventory
      const inventoryModalEl = document.getElementById('inventory');
      const inventoryCloseEl = document.getElementById('inventory_close_button');
      const inventoryDetailModalEl = document.getElementById('inventory_detail');
      const inventoryDetailCloseEl = document.getElementById('inventory_detail_close_button');
      const gpEl = document.getElementById('gp');
      const equippedItemsEl = document.getElementById('equipped_items');
      const unequippedInventoryEl = document.getElementById('unequipped_items');
      const inventoryDetailItemEl = document.getElementById('inventory_detail_item');
      const inventoryDetailActionsEl = document.getElementById('inventory_detail_actions');
      // game menu
      const gameMenuModalEl = document.getElementById('game_menu');
      const gameMenuTitleEl = document.getElementById('game_menu_title');
      const gameMenuDescriptionEl = document.getElementById('game_menu_description');
      const gameMenuButtonEl = document.getElementById('game_menu_button');

      // data binding
      const UI = {
        xp: {
          element: xpEl,
          value: (el, state) => {
            const currentXp = new Intl.NumberFormat(navigator.language).format(state.xp);
            const xpForLevel = new Intl.NumberFormat(navigator.language).format(getXpForLevel(state.level));
            el.innerHTML = `${currentXp} / ${xpForLevel} xp`;
          },
        },
        xpStatus: { element: xpStatusEl, value: (el, state) => {
          const percent = state.xp / getXpForLevel(state.level);
          el.setAttribute('style', `width: ${percent * 100}%`);
        }, },
        hp: {
          element: hpEl,
          value: (el, state) => {
            const calcdHp = state.hp - state.wounds;
            const currentHp = new Intl.NumberFormat(navigator.language).format(calcdHp < 0 ? 0 : calcdHp);
            const totalHp = new Intl.NumberFormat(navigator.language).format(state.hp);
            el.innerHTML = `${currentHp} / ${totalHp} hp`;
          },
        },
        hpStatus: { element: hpStatusEl, value: (el, state) => {
          const percent = (state.hp - state.wounds) / state.hp;
          if (percent < .25) {
            el.classList.add('bar_filler-danger');
          } else {
            el.classList.remove('bar_filler-danger');
          }
          el.setAttribute('style', `width: ${percent * 100}%`);
        }, },
        gp: {
          element: gpEl,
          value: (el, state) => {
            el.innerHTML = `${el, state.gp} gp`;
          },
        },
        level: {
          element: levelEl,
          value: (el, state) => {
            el.innerHTML = `Level ${state.level}`;
          },
        },
        lootDrop: {
          element: lootDropEl,
          value: (() => {
            let lastLootIndex;
            return (el, state) => {
              if (state.inventory.length - 1 > lastLootIndex) {
                const newestLoot = state.inventory[state.inventory.length - 1];
                loot.innerHTML = `Dropped: ${newestLoot.name}`;
                setTimeout(() => {
                  loot.innerHTML = '';
                }, 2000);
              }
              lastLootIndex = state.inventory.length - 1;
            };
          })(),
        },
        enemyName: {
          element: enemyNameEl,
          value: (el, state) => {
            if (state.enemy) {
              el.innerHTML = state.enemy.name;
            }
          },
        },
        enemyLevel: {
          element: enemyLevelEl,
          value: (el, state) => {
            if (state.enemy) {
              el.innerHTML = `Level ${state.enemy.level}`;
            }
          }
        },
        enemyHp: {
          element: enemyHpEl,
          value: (el, state) => {
            if (state.enemy) {
              el.innerHTML = `${state.enemy.hp} / ${state.enemy.maxHp} hp`;
            }
            lastEnemy = state.enemy;
          },
        },
        enemyHpStatus: {
          element: enemyHpStatusEl,
          value: (el, state) => {
            if (state.enemy) {
              const percent = state.enemy.hp / state.enemy.maxHp;
              el.setAttribute('style', `width: ${percent * 100}%`);
            }
            lastEnemy = state.enemy;
          },
        },
        equippedItems: {
          element: equippedItemsEl,
          value: (el, state) => {
            el.innerHTML = null;

            equipmentSlots.forEach((slot) => {
              const equippedItem = state.inventory.find((item) => item.equipped === slot.key);

              const slotNameEl = document.createElement('p');
              slotNameEl.classList.add('label-small', 'inventory_category');
              slotNameEl.innerText = slot.value;
              el.appendChild(slotNameEl);

              const itemSlotEl = document.createElement('a');
              itemSlotEl.addEventListener('click', () => toModalSubMenu(equippedItem));
              itemSlotEl.setAttribute('href', '#');
              itemSlotEl.classList.add('inventory_item');
              

              const itemNameEl = document.createElement('p');
              itemNameEl.classList.add('label-large');
              itemNameEl.innerText = equippedItem ? equippedItem.name : 'Nothing';
              itemSlotEl.appendChild(itemNameEl);

              const itemStatEl = document.createElement('p');
              itemStatEl.classList.add('label-medium');
              itemStatEl.innerText = equippedItem ? `${equippedItem.power} ${equippedItem.statType}` : 'N/A';
              itemSlotEl.appendChild(itemStatEl);

              el.appendChild(itemSlotEl);
            });
          },
        },
        unequippedItems: {
          element: unequippedInventoryEl,
          value: (el, state) => {
            el.innerHTML = null;

            const unequipped = state.inventory.filter((item) => !item.equipped);
            unequipped.forEach((item) => {
              const itemEl = document.createElement('li');

              const itemLinkEl = document.createElement('a');
              itemLinkEl.addEventListener('click', () => toModalSubMenu(item));
              itemLinkEl.setAttribute('href', '#');
              itemLinkEl.classList.add('inventory_item');
              itemEl.appendChild(itemLinkEl);

              const nameEl = document.createElement('p');
              nameEl.innerHTML = item.name;
              nameEl.classList.add('label-large');
              itemLinkEl.appendChild(nameEl);

              const statEl = document.createElement('p');
              statEl.innerHTML = `${item.power} ${item.statType}`;
              statEl.classList.add('label-medium');
              itemLinkEl.appendChild(statEl);

              el.appendChild(itemEl);
            });
          },
        },
        inventoryDetailItem: {
          element: inventoryDetailItemEl,
          value: (el, state) => {
            el.innerHTML = null;

            if (!state.inventoryItem) {
              return;
            }

            const inventoryItemTypeEl = document.createElement('p');
            inventoryItemTypeEl.classList.add('label-small', 'inventory_category');
            inventoryItemTypeEl.innerText = state.inventoryItem.type.type;
            el.appendChild(inventoryItemTypeEl);

            const inventoryItemInfoContainerEl = document.createElement('div');
            inventoryItemInfoContainerEl.classList.add('inventory_item', 'inventory_item-border');

            const inventoryItemInfoNameEl = document.createElement('p');
            inventoryItemInfoNameEl.classList.add('label-large');
            inventoryItemInfoNameEl.innerText = state.inventoryItem.name;
            inventoryItemInfoContainerEl.appendChild(inventoryItemInfoNameEl);

            const inventoryItemInfoStatEl = document.createElement('p');
            inventoryItemInfoStatEl.classList.add('label-medium');
            inventoryItemInfoStatEl.innerText = `${state.inventoryItem.power} ${state.inventoryItem.statType}`;
            inventoryItemInfoContainerEl.appendChild(inventoryItemInfoStatEl);

            el.appendChild(inventoryItemInfoContainerEl);
          },
        },
        inventoryDetailActions: {
          element: inventoryDetailActionsEl,
          value: (el, state) => {
            el.innerHTML = null;

            if (!state.inventoryItem) {
              return;
            }

            const elements = [];

            const isHandItem = state.inventoryItem.type.type === 'HAND';

            if (isHandItem && !state.inventoryItem.equipped) {
              const equipLeftActionEl = document.createElement('button');
              equipLeftActionEl.setAttribute('type', 'button');
              equipLeftActionEl.classList.add('action_button', 'action_button-hollow');
              equipLeftActionEl.innerText = 'Equip Left';
              equipLeftActionEl.addEventListener('click', () => {
                equipItem('LEFT_HAND', state.inventoryItem);
              });
              elements.push(equipLeftActionEl);

              const equipRightActionEl = document.createElement('button');
              equipRightActionEl.setAttribute('type', 'button');
              equipRightActionEl.classList.add('action_button', 'action_button-hollow');
              equipRightActionEl.innerText = 'Equip Right';
              equipRightActionEl.addEventListener('click', () => {
                equipItem('RIGHT_HAND', state.inventoryItem);
              });
              elements.push(equipRightActionEl);
            } else if (!state.inventoryItem.equipped) {
              const equipActionEl = document.createElement('button');
              equipActionEl.setAttribute('type', 'button');
              equipActionEl.classList.add('action_button', 'action_button-hollow');
              equipActionEl.innerText = 'Equip';
              equipActionEl.addEventListener('click', () => {
                equipItem(state.inventoryItem.type.type, state.inventoryItem);
              });
              elements.push(equipActionEl);
            } else {
              const equipActionEl = document.createElement('button');
              equipActionEl.setAttribute('type', 'button');
              equipActionEl.classList.add('action_button', 'action_button-hollow');
              equipActionEl.innerText = 'Unequip';
              equipActionEl.addEventListener('click', () => {
                gameState.setState({
                  inventory: state.inventory.map((item) => {
                    if (item === state.inventoryItem) {
                      return {
                        ...state.inventoryItem,
                        equipped: null,
                      };
                    }
                    return item;
                  }),
                  inventoryItem: {
                    ...state.inventoryItem,
                    equipped: null,
                  },
                });
                updateUi(gameState.getState());
                save();
              });
              elements.push(equipActionEl);
            }

            const trashItemEl = document.createElement('button');
            trashItemEl.setAttribute('type', 'button');
            trashItemEl.classList.add('action_button', 'action_button-hollow');
            trashItemEl.innerText = 'Discard';
            trashItemEl.addEventListener('click', () => {
              gameState.setState({
                inventory: gameState.getState().inventory.filter((item) => item !== state.inventoryItem),
              });
              fromModalSubMenu();
            });
            elements.push(trashItemEl);

            elements.forEach((newElement) => { el.appendChild(newElement); });
          },
        },
      };
      const updateUi = (currentState) => {
        Object.values(UI).forEach(item => {
          item.value(item.element, currentState);
        });
      };

      // actions
      gameMenuButtonEl.addEventListener('click', () => {
        localStorage.removeItem('rpg-state');
        load();
        attackButtonEl.disabled = false;
        gameMenuModalEl.classList.remove('modal-visible');
      });
      if (typeof window.ontouchstart === 'undefined') {
        attackButtonEl.addEventListener('mousedown', onAttack);
        attackButtonEl.addEventListener('mouseup', tick);
      }
      attackButtonEl.addEventListener('touchstart', onAttack);
      attackButtonEl.addEventListener('touchend', tick);
      inventoryButtonEl.addEventListener('click', () => {
        inventoryModalEl.classList.add('modal-visible');
      });
      inventoryCloseEl.addEventListener('click', () => {
        inventoryModalEl.classList.remove('modal-visible');
      });
      function toModalSubMenu(item) {
        gameState.setState({ inventoryItem: item });
        updateUi(gameState.getState());
        inventoryModalEl.classList.add('modal-sub');
        inventoryDetailModalEl.classList.add('modal-visible');
      }
      function fromModalSubMenu() {
        inventoryModalEl.classList.remove('modal-sub');
        inventoryDetailModalEl.classList.remove('modal-visible');
        gameState.setState({ inventoryItem: null });
        updateUi(gameState.getState());
      }
      inventoryDetailCloseEl.addEventListener('click', fromModalSubMenu);
      function showWound(text) {
        woundIndicatorEl.innerText = text;
        woundIndicatorEl.classList.add('wound-lit');
        setTimeout(() => {
          woundIndicatorEl.innerText = null;
          woundIndicatorEl.classList.remove('wound-lit');
        }, 875)
      }


      /* INIT GAME */
      function continueIf() {
        if (localStorage.getItem(SAVE_KEY)) {
          gameMenuModalEl.classList.remove('modal-visible');
        }
      }
      continueIf();
      load();
    </script>
  </body>
</html>
